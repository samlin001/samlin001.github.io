<!DOCTYPE html>
<html>
  <head>
    <title>WebUSB test app</title>
  </head>

<body>
  <script>

// https://developer.chrome.com/articles/usb/
// https://wicg.github.io/webusb/#usbdevice
var webUsbDevice = {};
var connectedUsbDeviceFilters = [];
var connectedUsbDeviceInfo = [];
(function() {
  'use strict';

  webUsbDevice.getDevices = function() {
    return navigator.usb.getDevices().then(devices => {
      return devices.map(device => new webUsbDevice.Device(device));
    });
  };

  // https://wicg.github.io/webusb/#dom-usb-requestdevice
  webUsbDevice.requestDevice = function() {
    return navigator.usb.requestDevice({ 'filters': connectedUsbDeviceFilters }).then(
      device => new webUsbDevice.Device(device)
    );
  }

  webUsbDevice.Device = function(device) {
    this.device_ = device;
  };

  webUsbDevice.Device.prototype.connect = function() {
    return this.device_.open()
        .then(() => {
          if (this.device_.configuration === null) {
            return this.device_.selectConfiguration(1);
          }
        })
        .then(() => this.device_.claimInterface(0))
        .then(() => {
          alert("Connected!");
          console.log("Connected");
        })
        .catch(err => alert(err.message));
  };

  webUsbDevice.Device.prototype.disconnect = function() {
    return this.device_.close();
  };
})();

let usbDevice;

function connect() {
  usbDevice.connect();
}

document.addEventListener('DOMContentLoaded', async () => {
    let devices = await navigator.usb.getDevices();
    devices.forEach(device => {
      connectedUsbDeviceFilters.push({'vendorId': device.vendorId,
                                      'productId': device.productId,
                                      'classCode': device.deviceClass});
      connectedUsbDeviceInfo.push(device.manufacturerName);
      connectedUsbDeviceInfo.push(device.productName);
      connectedUsbDeviceInfo.push("vendorId=");
      connectedUsbDeviceInfo.push(device.vendorId);
      connectedUsbDeviceInfo.push('productId=');
      connectedUsbDeviceInfo.push(device.productId);
      connectedUsbDeviceInfo.push('classCode=');
      connectedUsbDeviceInfo.push(device.deviceClass);
      connectedUsbDeviceInfo.push('\n');
    });
    alert(connectedUsbDeviceInfo.join(" "));
  });

window.onload = _ => {
  document.querySelector("#connectBtn").onclick = function() {
    webUsbDevice.requestDevice().then(uDevice => {
      usbDevice = uDevice;
      connect();
    });
  }
}

</script>
 <button id="connectBtn" style="visibility: initial">Connect to a usb host device</button>
</body>
